import Fuse from "fuse.js";

const faqList = [
  {
    question: "как выбрать вас провайдером",
    answer: "Чтобы выбрать нас провайдером, откройте чат с поддержкой в приложении Яндекс Про, напишите: «Я хочу перейти в Payda ЭДО», укажите свой ИИН и получите подтверждение. Затем перейдите на сайт https://taxi.edo.kz и завершите регистрацию."
  },
  {
    question: "как перейти в Payda ЭДО",
    answer: "Чтобы перейти в Payda ЭДО, напишите в поддержку Яндекс Про: «Хочу перейти в Payda ЭДО», укажите свой ИИН и получите подтверждение. Затем зарегистрируйтесь на сайте https://taxi.edo.kz."
  },
  {
    question: "сколько стоят услуги",
    answer: "Первый месяц подписания — бесплатно. Со второго месяца стоимость составляет 500 тг в месяц для ИП, а для водителей таксопарков — бесплатно. Оплатить можно через приложение Kaspi."
  },
  {
    question: "как оплатить услуги",
    answer: "Со второго месяца вы увидите окно с оплатой. Оплатить можно через приложение Kaspi."
  },
  {
    question: "где мои документы АВР и ЭСФ",
    answer: "В вашем личном кабинете на https://taxi.edo.kz в разделе «Документы» отображаются все неподписанные документы. Для массового подписания нажмите «Подписать в eGov Mobile» и следуйте инструкциям."
  },
  {
    question: "не вижу документы в кабинете",
    answer: "Если вы зашли на сайт и не видите свои документы, возможно, вы перешли к нам после 3-го числа, и Яндекс не успел сформировать и отправить их. Вы можете самостоятельно сформировать АВР и ЭСФ за текущий месяц или подождать начала следующего месяца."
  },
  {
    question: "как узнать, подписаны ли документы",
    answer: "Перейдите в свой личный кабинет на https://taxi.edo.kz, откройте раздел «Документы» и проверьте статус документов. Подписанные документы будут отображаться со статусом «Подписано»."
  },
  {
    question: "у меня нет регистрации в ИС ЭСФ",
    answer: "Перейдите на сайт https://esf.gov.kz:8443/esf-web/app и нажмите «Регистрация». Выберите тип регистрации «ИП» или «Физическое лицо», затем следуйте инструкциям для завершения регистрации."
  },
  {
    question: "как восстановить пароль в ИС ЭСФ",
    answer: "Перейдите на сайт https://esf.gov.kz:8443, нажмите «Войти в систему» и выберите свой ЭЦП. Затем нажмите на кнопку «Забыл пароль» и следуйте инструкциям для восстановления пароля."
  },
  {
    question: "не валидный сертификат",
    answer: "Если ваш сертификат невалиден, вам нужно перевыпустить ЭЦП ключ. В настоящее время используется новый формат с одним ключом вместо двух. Выпустите новый ЭЦП через приложение eGov Mobile."
  },
  {
    question: "система не подключена к функции подписания в eGov Mobile",
    answer: "Это сообщение появляется, если у вас установлена бета-версия приложения eGov. Чтобы выйти из этого режима, откройте Play Market, найдите приложение eGov, прокрутите страницу вниз и нажмите «Выйти» из бета-программы. Затем установите приложение заново."
  },
  {
    question: "бесконечно запрашивает пароль ИС ЭСФ",
    answer: "Если система бесконечно запрашивает пароль от ИС ЭСФ, проверьте, не находитесь ли в режиме инкогнито в браузере. Очистите кэш браузера, закройте и откройте приложение eGov заново. Если проблема сохраняется, возможно, у вас неправильный пароль от ИС ЭСФ."
  }
];

const fuse = new Fuse(faqList, {
  keys: ["question"],
  threshold: 0.3,
  includeScore: true
});

export function findAnswer(message) {
  if (!message || message.trim().length < 5) return null; // игнорируем слишком короткие

  const results = fuse.search(message.toLowerCase());

  if (results.length === 0) return null;

  const [best] = results;

  if (best.score > 0.25) return null; // слабое совпадение — игнорим

  return best.item.answer;
}
